# CCline 排名功能说明

## 功能概述

CCline 现在支持在状态栏中显示 PackyCode 平台的实时消费排名！这个功能使用 JWT 验证码来获取您在同行中的消费排名。

## 功能特性

- 🥇 **实时排名显示**: 显示您在同行消费者中的实时排名
- 🔐 **JWT 认证**: 使用安全的 JWT token 进行 API 认证
- 🎨 **视觉化排名**: 根据排名显示不同的奖牌图标
  - 🥇 第1名 (金牌)
  - 🥈 第2名 (银牌) 
  - 🥉 第3名 (铜牌)
  - 📊 其他排名
- 📊 **集成显示**: 排名和垃圾话集成在金额后面显示
- 🎭 **趣味垃圾话**: 根据排名显示不同的鼓励/调侃文字

## 状态栏示例

```
❤️ Today: $42.91 🥈 2 (距上一名$31.26) 工作强度还行    // 金额 + 排名 + 距上一名差距 + 垃圾话
❤️ Today: $74.17 🥇 1 API调用狂魔降临              // 第1名：无差距显示
❤️ Today: $4.21 📊 5 (距上一名$8.01) 摸鱼冠军就是你   // 最后一名的显示效果
```

## 配置方法

### 方法1: 使用环境变量 (推荐)

设置环境变量 `PACKYCODE_JWT_TOKEN`:

```bash
# Windows (PowerShell)
$env:PACKYCODE_JWT_TOKEN="your_jwt_token_here"

# Windows (CMD)
set PACKYCODE_JWT_TOKEN=your_jwt_token_here

# Linux/macOS
export PACKYCODE_JWT_TOKEN="your_jwt_token_here"
```

### 方法2: 修改源代码

如果不设置环境变量，程序会使用代码中预设的 JWT token。

## 获取 JWT Token

1. 登录 PackyCode 网站 (https://share.packycode.com)
2. 打开浏览器开发者工具 (F12)
3. 在 Network 标签页中查找 API 请求
4. 复制请求头中的 `Authorization: Bearer` 后面的 token

## 配置文件设置

在配置文件中启用排名显示:

```toml
[segments]
ranking = true  # 启用排名显示
```

## API 端点

排名功能使用以下 PackyCode API 端点:

- **排名数据**: `https://share.packycode.com/api/backend/accounts/peer-spending/today`
- **用户信息**: `https://share.packycode.com/api/backend/users/info`

## 错误处理

- 如果 API 请求失败，会显示 `📊 排名错误`
- 如果没有排名数据，会显示 `📊 无排名数据`
- 如果正在获取数据，会显示 `📊 排名获取中`

## 注意事项

1. **Token 有效期**: JWT token 有过期时间，需要定期更新
2. **网络连接**: 需要稳定的网络连接来获取实时数据
3. **隐私保护**: 排名数据已脱敏，只显示排名位置，不显示具体消费金额
4. **更新频率**: 每次状态栏刷新时都会获取最新排名数据

## 故障排除

### 排名显示错误
- 检查 JWT token 是否有效
- 确认网络连接正常
- 验证 API 端点是否可访问

### Token 过期
- 重新登录 PackyCode 网站获取新的 JWT token
- 更新环境变量或源代码中的 token

## 技术实现

- 使用 `curl` 命令进行 HTTP 请求
- JSON 响应解析使用 `serde_json`
- 支持跨平台 (Windows/Linux/macOS)
- 异步数据获取，不阻塞状态栏渲染

## 垃圾话列表 (十个字以内)

### 🥇 第一名垃圾话
- 大佬牛逼克拉斯、钞能力MAX爆表了、土豪本豪就是你、氪金战神降临人间、人民币玩家无敌、财富密码已破解、烧钱冠军当之无愧、金钱碾压一切众生

### 🥈 第二名垃圾话
- 就差一丢丢就第一了、氪金不够啊兄弟、钱包还行继续冲、小有实力值得表扬、差点意思再努力、还能再冲一把、钞票加油别停下、快上车追第一名

### 🥉 第三名垃圾话
- 勉强及格铜牌选手、平平无奇普通人、普通玩家没特色、钱包一般般啦、中等水平还可以、还凑合吧继续努力、没啥特色的存在、路人甲乙丙丁

### 📊 中间排名垃圾话
- 钱包瘪了要充值、穷鬼预警快跑路、省钱达人本达人、抠门专家级选手、钱不够花怎么办、囊中羞涩很尴尬、经济困难户代表、节俭持家好榜样

### 📊 最后一名垃圾话
- 小卡拉米本拉米、穷到吃土都没土、钱包空空如也啊、破产边缘危险了、一毛不拔铁公鸡、抠门冠军就是你、贫穷限制了想象、吃土少年要坚强

## 新增功能

### 💰 与第一名差距显示
- 显示格式：`(-$29.84)` 表示比第一名少花费 $29.84
- 仅在非第一名时显示
- 第一名不显示差距信息

### 🚀 性能优化
- 取消网络延迟显示 (默认关闭 `| 🟩 0ms`)
- 更流畅的状态栏体验

## 示例输出

```
 _:(´□`」 ∠):_  | 🤖 Claude 3.5 Sonnet | 📁 packycc | 📊 0.0% · 0 tokens | ❤️ Today: $42.91 🥈 2 (-$29.84) 氪金不够啊 | 👋 🤚 ✋
```

在这个例子中，`❤️ Today: $42.91 🥈 2 (-$29.84) 氪金不够啊` 完整显示了：
- 今日消费金额：$42.91
- 排名图标：🥈 (银牌)
- 排名位置：2
- 与第一名差距：(-$29.84)
- 垃圾话：氪金不够啊
